"use strict";(self.webpackChunktcadmin_docs=self.webpackChunktcadmin_docs||[]).push([[5030],{3905:(e,t,n)=>{n.d(t,{Zo:()=>l,kt:()=>g});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=r.createContext({}),p=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},l=function(e){var t=p(e.components);return r.createElement(c.Provider,{value:t},e.children)},m="mdxType",f={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,c=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),m=p(n),d=i,g=m["".concat(c,".").concat(d)]||m[d]||f[d]||o;return n?r.createElement(g,a(a({ref:t},l),{},{components:n})):r.createElement(g,a({ref:t},l))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[m]="string"==typeof e?e:i,a[1]=s;for(var p=2;p<o;p++)a[p]=n[p];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1752:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>f,frontMatter:()=>o,metadata:()=>s,toc:()=>p});var r=n(7462),i=(n(7294),n(3905));const o={sidebar_position:6,sidebar_label:"Check slots, ip and port in config file before starting"},a="Check slots, ip and port in config file before starting",s={unversionedId:"customizations/scripts/general-scripts/check-slots-ip-ports-in-config-file-before-starting",id:"customizations/scripts/general-scripts/check-slots-ip-ports-in-config-file-before-starting",title:"Check slots, ip and port in config file before starting",description:"Option 1 - Update values if they have been modified (requires database connection)",source:"@site/docs/customizations/scripts/general-scripts/check-slots-ip-ports-in-config-file-before-starting.mdx",sourceDirName:"customizations/scripts/general-scripts",slug:"/customizations/scripts/general-scripts/check-slots-ip-ports-in-config-file-before-starting",permalink:"/customizations/scripts/general-scripts/check-slots-ip-ports-in-config-file-before-starting",draft:!1,editUrl:"https://github.com/TotalControlAdmin/tcadmin-docs/blob/master/docs/customizations/scripts/general-scripts/check-slots-ip-ports-in-config-file-before-starting.mdx",tags:[],version:"current",lastUpdatedAt:1696666871,formattedLastUpdatedAt:"Oct 7, 2023",sidebarPosition:6,frontMatter:{sidebar_position:6,sidebar_label:"Check slots, ip and port in config file before starting"},sidebar:"tutorialSidebar",previous:{title:"Backup & Restore Scripts with FTP Support",permalink:"/customizations/scripts/general-scripts/backup-restore-scripts-with-ftp-support"},next:{title:"Custom Login Form",permalink:"/customizations/scripts/general-scripts/custom-login-form"}},c={},p=[{value:"Option 1 - Update values if they have been modified (requires database connection)",id:"option-1---update-values-if-they-have-been-modified-requires-database-connection",level:2},{value:"Option 2 - Prevent service from starting if values have been modified (no database connection required)",id:"option-2---prevent-service-from-starting-if-values-have-been-modified-no-database-connection-required",level:2},{value:"Option 3 - JSON config file",id:"option-3---json-config-file",level:2}],l={toc:p},m="wrapper";function f(e){let{components:t,...n}=e;return(0,i.kt)(m,(0,r.Z)({},l,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"check-slots-ip-and-port-in-config-file-before-starting"},"Check slots, ip and port in config file before starting"),(0,i.kt)("h2",{id:"option-1---update-values-if-they-have-been-modified-requires-database-connection"},"Option 1 - Update values if they have been modified (requires database connection)"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Go to the game's settings. "),(0,i.kt)("li",{parentName:"ol"},"Click on the Custom Scripts icon. "),(0,i.kt)("li",{parentName:"ol"},"Add the following script. "),(0,i.kt)("li",{parentName:"ol"},"After creating the script go to the game's settings and click on Update Existing Services. "),(0,i.kt)("li",{parentName:"ol"},"To test the script on a single game server go to the service settings and save. Then start the game server.")),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},'This script connects to the database. If the database is offline the script will fail. You should have "Ignore execution errors" checked in case the database connection is not available when the script executes.')),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Operating System:")," Any",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"Description:")," Check slots, IP, and port in the config file before starting",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"Script Engine:")," IronPython",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"Event:")," Before started",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"Ignore execution errors:")," Checked"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'import clr;\nfrom System.IO import File, Path\nfrom System import Environment\n \n#Load objects from database.\nclr.AddReference("TCAdmin.GameHosting.SDK")\nfrom TCAdmin.GameHosting.SDK.Objects import Server, Service, Game\nThisService=Service(ThisService_ServiceId)\nThisServer=Server(ThisService.ServerId)\nThisGame=Game(ThisService.GameId)\n       \n#Update values if changed.\nThisServer.GameHostingUtilitiesService.UpdateConfigFileVariableValues(ThisService.ServiceId)\n')),(0,i.kt)("h2",{id:"option-2---prevent-service-from-starting-if-values-have-been-modified-no-database-connection-required"},"Option 2 - Prevent service from starting if values have been modified (no database connection required)"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Go to the game's settings. "),(0,i.kt)("li",{parentName:"ol"},"Click on the Custom Scripts icon. "),(0,i.kt)("li",{parentName:"ol"},"Add the following script. "),(0,i.kt)("li",{parentName:"ol"},"This can also be configured as a global script. "),(0,i.kt)("li",{parentName:"ol"},"After creating the script go to the game's settings and click on Update Existing Services. "),(0,i.kt)("li",{parentName:"ol"},"To test the script on a single game server go to the service settings and save. "),(0,i.kt)("li",{parentName:"ol"},"Then start the game server. "),(0,i.kt)("li",{parentName:"ol"},"If the IP, port or slots don't have the correct values you will see an error message."),(0,i.kt)("li",{parentName:"ol"},"Update the values of ",(0,i.kt)("inlineCode",{parentName:"li"},"slots_regex"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"ip_regex")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"port_regex")," with regular expressions to read the current values. Remember to escape ",(0,i.kt)("inlineCode",{parentName:"li"},"\\")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"\\\\"),". By default these values are configured for San Andreas Multiplayer.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Operating System:")," Any",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"Description:")," Check slots, IP, and port in the config file before starting",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"Script Engine:")," IronPython",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"Event:")," Before started",(0,i.kt)("br",{parentName:"p"}),"\n",(0,i.kt)("strong",{parentName:"p"},"Ignore execution errors:")," Checked"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'import clr;\nfrom System.IO import File, Path\nfrom System.Text.RegularExpressions import Regex, RegexOptions\nfrom System import Exception, String;\n\nslots_regex = "^\\\\s*maxplayers\\\\s+(?<slots>\\\\d+)"\nip_regex = "^\\s*bind\\\\s+(?<ip>[\\\\d\\\\.]+)"\nport_regex = "^\\\\s*port\\\\s+(?<port>\\\\d+)"\n\nconfigpath=Path.Combine(ThisService_RootDirectory, "server.cfg")\nif File.Exists(configpath):\n  contents=File.ReadAllText(configpath)\n  \n  #Match slots\n  matches = Regex.Matches(contents, slots_regex, RegexOptions.Multiline)\n  if matches.Count == 0:\n    raise Exception("maxplayers has been removed from server.cfg")\n \n  for match in matches:\n    realslots=int(match.Groups["slots"].Value)\n    allowslots=int(ThisService_Slots)\n    if realslots > allowslots:\n      raise Exception(String.Format("maxplayers has been increased to {0}. The correct value is {1}.", realslots, allowslots))\n   \n  #Match ip\n  matches = Regex.Matches(contents, ip_regex, RegexOptions.Multiline)\n  if matches.Count == 0:\n    raise Exception("bind has been removed from server.cfg")\n  \n  for match in matches:\n    realip=match.Groups["ip"].Value\n    allowip=ThisService_IpAddress\n    if realip != allowip:\n      raise Exception(String.Format("bind has been changed to {0}. The correct value is {1}.", realip, allowip))\n      \n  #Match port\n  matches = Regex.Matches(contents, port_regex, RegexOptions.Multiline)\n  if matches.Count == 0:\n    raise Exception("port has been removed from server.cfg")\n  \n  for match in matches:\n    realport=int(match.Groups["port"].Value)\n    allowport= int(ThisService_GamePort)\n    if realport != allowport:\n      raise Exception(String.Format("port has been changed to {0}. The correct value is {1}.", realport, allowport))\n')),(0,i.kt)("h2",{id:"option-3---json-config-file"},"Option 3 - JSON config file"),(0,i.kt)("p",null,"This script updates the ip, port and slots in a config file with json format. This example is for Rage MP"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'import clr;\nimport System;\nclr.AddReference("Newtonsoft.Json")\nfrom System.IO import File, Path\nfrom Newtonsoft.Json import JsonConvert, Formatting\n\nconfigpath=Path.Combine(ThisService_RootDirectory, "conf.json")\n\nif File.Exists(configpath):\n  contents=File.ReadAllText(configpath)\n  jsondata = JsonConvert.DeserializeObject(contents)\n  jsondata["bind"]=ThisService_IpAddress\n  jsondata["port"]=ThisService_GamePort\n  jsondata["maxplayers"]=ThisService_Slots\n  File.WriteAllText(configpath, JsonConvert.SerializeObject(jsondata, Formatting.Indented))\n\n')))}f.isMDXComponent=!0}}]);