"use strict";(self.webpackChunktcadmin_docs=self.webpackChunktcadmin_docs||[]).push([[1635],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(n),m=i,g=p["".concat(l,".").concat(m)]||p[m]||d[m]||r;return n?a.createElement(g,o(o({ref:t},u),{},{components:n})):a.createElement(g,o({ref:t},u))}));function g(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=n[c];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(7294),i=n(6010);const r={tabItem:"tabItem_Ymn6"};function o(e){let{children:t,hidden:n,className:o}=e;return a.createElement("div",{role:"tabpanel",className:(0,i.Z)(r.tabItem,o),hidden:n},t)}},4866:(e,t,n)=>{n.d(t,{Z:()=>w});var a=n(7462),i=n(7294),r=n(6010),o=n(2466),s=n(6550),l=n(1980),c=n(7392),u=n(12);function p(e){return function(e){return i.Children.map(e,(e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:i}}=e;return{value:t,label:n,attributes:a,default:i}}))}function d(e){const{values:t,children:n}=e;return(0,i.useMemo)((()=>{const e=t??p(n);return function(e){const t=(0,c.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function m(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function g(e){let{queryString:t=!1,groupId:n}=e;const a=(0,s.k6)(),r=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,l._X)(r),(0,i.useCallback)((e=>{if(!r)return;const t=new URLSearchParams(a.location.search);t.set(r,e),a.replace({...a.location,search:t.toString()})}),[r,a])]}function f(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,r=d(e),[o,s]=(0,i.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!m({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:r}))),[l,c]=g({queryString:n,groupId:a}),[p,f]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,r]=(0,u.Nk)(n);return[a,(0,i.useCallback)((e=>{n&&r.set(e)}),[n,r])]}({groupId:a}),h=(()=>{const e=l??p;return m({value:e,tabValues:r})?e:null})();(0,i.useLayoutEffect)((()=>{h&&s(h)}),[h]);return{selectedValue:o,selectValue:(0,i.useCallback)((e=>{if(!m({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);s(e),c(e),f(e)}),[c,f,r]),tabValues:r}}var h=n(2389);const k={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function b(e){let{className:t,block:n,selectedValue:s,selectValue:l,tabValues:c}=e;const u=[],{blockElementScrollPositionUntilNextRender:p}=(0,o.o5)(),d=e=>{const t=e.currentTarget,n=u.indexOf(t),a=c[n].value;a!==s&&(p(t),l(a))},m=e=>{let t=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const n=u.indexOf(e.currentTarget)+1;t=u[n]??u[0];break}case"ArrowLeft":{const n=u.indexOf(e.currentTarget)-1;t=u[n]??u[u.length-1];break}}t?.focus()};return i.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":n},t)},c.map((e=>{let{value:t,label:n,attributes:o}=e;return i.createElement("li",(0,a.Z)({role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,key:t,ref:e=>u.push(e),onKeyDown:m,onClick:d},o,{className:(0,r.Z)("tabs__item",k.tabItem,o?.className,{"tabs__item--active":s===t})}),n??t)})))}function v(e){let{lazy:t,children:n,selectedValue:a}=e;const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(t){const e=r.find((e=>e.props.value===a));return e?(0,i.cloneElement)(e,{className:"margin-top--md"}):null}return i.createElement("div",{className:"margin-top--md"},r.map(((e,t)=>(0,i.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function y(e){const t=f(e);return i.createElement("div",{className:(0,r.Z)("tabs-container",k.tabList)},i.createElement(b,(0,a.Z)({},e,t)),i.createElement(v,(0,a.Z)({},e,t)))}function w(e){const t=(0,h.Z)();return i.createElement(y,(0,a.Z)({key:String(t)},e))}},4819:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>g,frontMatter:()=>s,metadata:()=>c,toc:()=>p});var a=n(7462),i=(n(7294),n(3905)),r=n(4866),o=n(5162);const s={sidebar_position:2,sidebar_label:"Setting up Nginx with TCAdmin"},l="Setting up Nginx with TCAdmin",c={unversionedId:"customizations/web-server-configurations/setting-up-nginx",id:"customizations/web-server-configurations/setting-up-nginx",title:"Setting up Nginx with TCAdmin",description:"The steps provided for configuring nginx in this guide are tailored for Ubuntu 22.04, which is the suggested and preferred operating system. Should you be utilizing a different operating system, consider this guide as a point of reference.",source:"@site/docs/customizations/web-server-configurations/setting-up-nginx.mdx",sourceDirName:"customizations/web-server-configurations",slug:"/customizations/web-server-configurations/setting-up-nginx",permalink:"/customizations/web-server-configurations/setting-up-nginx",draft:!1,editUrl:"https://github.com/TotalControlAdmin/tcadmin-docs/blob/master/docs/customizations/web-server-configurations/setting-up-nginx.mdx",tags:[],version:"current",lastUpdatedAt:1693212227,formattedLastUpdatedAt:"Aug 28, 2023",sidebarPosition:2,frontMatter:{sidebar_position:2,sidebar_label:"Setting up Nginx with TCAdmin"},sidebar:"tutorialSidebar",previous:{title:"Setting up IIS with TCAdmin",permalink:"/customizations/web-server-configurations/setting-up-iis"},next:{title:"Setting up ASPNET IIS Classic",permalink:"/customizations/web-server-configurations/aspnet-iis-classic"}},u={},p=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installing Nginx",id:"installing-nginx",level:2},{value:"Checking your Web Server",id:"checking-your-web-server",level:2},{value:"Configure TCAdmin to Execute the Fastcgi Server",id:"configure-tcadmin-to-execute-the-fastcgi-server",level:2},{value:"Use HyperFastCgi (optional)",id:"use-hyperfastcgi-optional",level:2},{value:"Update tcadmin-config",id:"update-tcadmin-config",level:2},{value:"Configure Nginx",id:"configure-nginx",level:2},{value:"Configure the control panel website",id:"configure-the-control-panel-website",level:2},{value:"Adding the custom TCAdmin server blocks",id:"adding-the-custom-tcadmin-server-blocks",level:3},{value:"After creating the file restart the nginx server:",id:"after-creating-the-file-restart-the-nginx-server",level:3},{value:"Configure the website to allow secure connections",id:"configure-the-website-to-allow-secure-connections",level:2},{value:"Get a certificate from Let&#39;s Encrypt",id:"get-a-certificate-from-lets-encrypt",level:3},{value:"Installing Certbot",id:"installing-certbot",level:3},{value:"Obtaining an SSL Certificate",id:"obtaining-an-ssl-certificate",level:3},{value:"Verifying Certbot Auto-Renewal",id:"verifying-certbot-auto-renewal",level:3},{value:"Create a self signed certificate (optional)",id:"create-a-self-signed-certificate-optional",level:3},{value:"Change the default ports (optional)",id:"change-the-default-ports-optional",level:2},{value:"Enable logging (optional)",id:"enable-logging-optional",level:2},{value:"Common Errors",id:"common-errors",level:2},{value:"Object reference error when logging in",id:"object-reference-error-when-logging-in",level:3},{value:"Port already in use",id:"port-already-in-use",level:3},{value:"Website doesn&#39;t load",id:"website-doesnt-load",level:3},{value:"Website errors every few minutes",id:"website-errors-every-few-minutes",level:3}],d={toc:p},m="wrapper";function g(e){let{components:t,...n}=e;return(0,i.kt)(m,(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"setting-up-nginx-with-tcadmin"},"Setting up Nginx with TCAdmin"),(0,i.kt)("admonition",{title:"important",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The steps provided for configuring nginx in this guide are tailored for Ubuntu 22.04, which is the suggested and preferred operating system. Should you be utilizing a different operating system, consider this guide as a point of reference.")),(0,i.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("p",null,"Prior to starting with this tutorial, ensure that you possess a standard user account with sudo privileges set up on your server, without using root access. ",(0,i.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-22-04"},"Initial server setup guide for Ubuntu 22.04.")),(0,i.kt)("p",null,"Additionally, it's recommended to have already registered a domain name before reaching the final stages of this guide. ",(0,i.kt)("a",{parentName:"p",href:"https://developers.cloudflare.com/registrar/get-started/register-domain/"},"Register a new domain")," If you already have a domain with DNS configured you can skip this step."),(0,i.kt)("p",null,"Once you have a valid account, initiate the process by logging in as your non-root user."),(0,i.kt)("h2",{id:"installing-nginx"},"Installing Nginx"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt update\nsudo apt install nginx\n")),(0,i.kt)("h2",{id:"checking-your-web-server"},"Checking your Web Server"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl status nginx\n")),(0,i.kt)("p",null,"Yoiu should see:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\u25cf nginx.service - A high performance web server and a reverse proxy server\n   Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)\n   Active: active (running) since Fri 2022-03-01 16:08:19 UTC; 3 days ago\n     Docs: man:nginx(8)\n Main PID: 2369 (nginx)\n    Tasks: 2 (limit: 1153)\n   Memory: 3.5M\n   CGroup: /system.slice/nginx.service\n           \u251c\u25002369 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;\n           \u2514\u25002380 nginx: worker processb\n")),(0,i.kt)("p",null,"More commands and info ",(0,i.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-22-04"},(0,i.kt)("strong",{parentName:"a"},"here"))),(0,i.kt)("h2",{id:"configure-tcadmin-to-execute-the-fastcgi-server"},"Configure TCAdmin to Execute the Fastcgi Server"),(0,i.kt)("p",null,"If you are running Debian or Ubunto with Mono 4 install the mono-fastcgi-server4 package:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt-get install mono-fastcgi-server4\n")),(0,i.kt)("h2",{id:"use-hyperfastcgi-optional"},"Use HyperFastCgi (optional)"),(0,i.kt)("p",null,"You can install HyperFastCgi which should give better performance and memory usage. TCAdmin will automatically detect HyperFastCgi and use it instead of the mono fastcgi. ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/xplicit/HyperFastCgi"},"https://github.com/xplicit/HyperFastCgi")),(0,i.kt)("h2",{id:"update-tcadmin-config"},"Update tcadmin-config"),(0,i.kt)("p",null,"Edit the file ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"tcadmin-config")),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo nano /home/tcadmin/Monitor/tcadmin-config\n")),(0,i.kt)("p",null,"Find and and change:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'ENABLE_FASTCGI_SERVER="False"\n')),(0,i.kt)("p",null,"to:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'ENABLE_FASTCGI_SERVER="True"\n')),(0,i.kt)("p",null,"Then restart the monitor service:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"/home/tcadmin/Monitor/monitor-service restart\n")),(0,i.kt)("h2",{id:"configure-nginx"},"Configure Nginx"),(0,i.kt)("p",null,"Edit the file ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"nginx.conf"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo nano /etc/nginx/nginx.conf\n")),(0,i.kt)("p",null,"Find and change:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"user nginx;\n")),(0,i.kt)("p",null,"to:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"user tcadmin;\n")),(0,i.kt)("p",null,"Then execute this command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo systemctl restart nginx\n")),(0,i.kt)("h2",{id:"configure-the-control-panel-website"},"Configure the control panel website"),(0,i.kt)("p",null,"run the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"sudo nano /etc/nginx/sites-available/default\n")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"If there is existing server blocks in the default file you can fully remove it ensuring the file is empty.")),(0,i.kt)("h3",{id:"adding-the-custom-tcadmin-server-blocks"},"Adding the custom TCAdmin server blocks"),(0,i.kt)("admonition",{title:"Important",type:"info"},(0,i.kt)("p",{parentName:"admonition"},"uncomment the ",(0,i.kt)("inlineCode",{parentName:"p"},"server_name.")," ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"(remove the #)"))," for the below conf file and enter your own domain name. (",(0,i.kt)("strong",{parentName:"p"},"Line: 15"),")")),(0,i.kt)("p",null,"add/replace the below server blocks to the ",(0,i.kt)("inlineCode",{parentName:"p"},"default folder")),(0,i.kt)(r.Z,{mdxType:"Tabs"},(0,i.kt)(o.Z,{value:"MVC",label:"MVC (Recommended)",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-conf",metastring:"showLineNumbers",showLineNumbers:!0},"upstream tcadmin-fcgi {\n        ip_hash;\n        server unix:/home/tcadmin/Temp/fastcgi-socket-1;\n        keepalive 32;\n}\n\nupstream tcadmin-fcgi-mvc {\n        ip_hash;\n        server unix:/home/tcadmin/Temp/fastcgi-socket-mvc-1;\n        keepalive 32;\n}\n\nserver {\n        #the following line is required if you want to configure with Let's Encrypt\n        #server_name tcadmin.yourdomain.com;\n        fastcgi_temp_path /home/tcadmin/Temp 1 2;\n        client_body_temp_path /home/tcadmin/Temp 1 2;\n        listen   8880;\n        #access_log   /home/tcadmin/Logs/nginx.log;\n        root /home/tcadmin/ControlPanel.MVC;\n        index index.html index.htm default.aspx Default.aspx;\n\n        #Support for Let's encrypt tools\n        location /.well-known {\n               try_files $uri $uri/ =404;\n        }\n\n        #Everything else served by fastcgi server\n        location / {\n               root /home/tcadmin/ControlPanel.MVC;\n               fastcgi_ignore_client_abort on;\n               fastcgi_pass tcadmin-fcgi-mvc;\n               include fastcgi_params;\n               fastcgi_split_path_info ^(.+\\.as[pmh]x)(.*)$;\n               fastcgi_param PATH_INFO $fastcgi_path_info;\n               fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;\n               fastcgi_keep_conn on;\n               fastcgi_buffering off;\n               fastcgi_read_timeout 600s;\n               gzip            on;\n               client_max_body_size 100m;\n       }\n\n        #Everything else served by fastcgi server\n        location /Aspx {\n               root /home/tcadmin/ControlPanel;\n               fastcgi_ignore_client_abort on;\n               fastcgi_index Default.aspx;\n               fastcgi_pass tcadmin-fcgi;\n               include fastcgi_params;\n               fastcgi_split_path_info ^(.+\\.as[pmh]x)(.*)$;\n               fastcgi_param PATH_INFO $fastcgi_path_info;\n               fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;\n               fastcgi_keep_conn on;\n               fastcgi_buffering off;\n               fastcgi_read_timeout 600s;\n               gzip            off;\n               client_max_body_size 100m;\n       }\n}\n"))),(0,i.kt)(o.Z,{value:"asp",label:"ASP.NET",mdxType:"TabItem"},(0,i.kt)("admonition",{title:"important",type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"This file is for TCAdmin 2.0.127 and earlier or if you have MVC templates disabled.")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-conf",metastring:"showLineNumbers",showLineNumbers:!0},"upstream tcadmin-fcgi {\n        ip_hash;\n        server unix:/home/tcadmin/Temp/fastcgi-socket-1;\n        keepalive 32;\n}\n\nserver {\n        #the following line is required if you want to configure with Let's Encrypt\n        #server_name tcadmin.yourdomain.com;\n        fastcgi_temp_path /home/tcadmin/Temp 1 2;\n        client_body_temp_path /home/tcadmin/Temp 1 2;\n        listen   8880;\n        #access_log   /home/tcadmin/Logs/nginx.log;\n        root /home/tcadmin/ControlPanel;\n        index index.html index.htm default.aspx Default.aspx;\n\n        #Support for Let's encrypt tools\n        location /.well-known {\n               try_files $uri $uri/ =404;\n        }\n        \n        #Static files are served by nginx\n        location ~ \\.(css|js|txt|xml|jpg|png|gif|ico)$ {\n               gzip            on;\n               gzip_min_length 1000;\n               gzip_proxied    expired no-cache no-store private auth;\n               gzip_types      text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;\n        }\n\n        #Everything else served by fastcgi server\n        location / {\n               fastcgi_ignore_client_abort on;\n               fastcgi_index Default.aspx;\n               fastcgi_pass tcadmin-fcgi;\n               include fastcgi_params;\n               fastcgi_split_path_info ^(.+\\.as[pmh]x)(.*)$;\n               fastcgi_param PATH_INFO $fastcgi_path_info;\n               fastcgi_param  SCRIPT_FILENAME    $document_root$fastcgi_script_name;\n               fastcgi_keep_conn on;\n               fastcgi_buffering off;\n               fastcgi_read_timeout 600s;\n               gzip            off;\n               client_max_body_size 100m;\n       }\n}\n")))),(0,i.kt)("h3",{id:"after-creating-the-file-restart-the-nginx-server"},"After creating the file restart the nginx server:"),(0,i.kt)("p",null,"first run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo nginx -t\n")),(0,i.kt)("p",null,"output:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"nginx: the configuration file /etc/nginx/nginx.conf syntax is ok\nnginx: configuration file /etc/nginx/nginx.conf test is successful\n")),(0,i.kt)("p",null,"if you do not get the above successful message you will need to double check your ",(0,i.kt)("inlineCode",{parentName:"p"},"default")," file is correct"),(0,i.kt)("p",null,"if all is correct you can run:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo systemctl restart nginx\n")),(0,i.kt)("h2",{id:"configure-the-website-to-allow-secure-connections"},"Configure the website to allow secure connections"),(0,i.kt)("h3",{id:"get-a-certificate-from-lets-encrypt"},"Get a certificate from Let's Encrypt"),(0,i.kt)("h3",{id:"installing-certbot"},"Installing Certbot"),(0,i.kt)("p",null,"Certbot suggests utilizing their snap package for installation. Snap packages are compatible with most Linux distributions, but prior to using them, you must have snapd installed to handle these packages. Notably, Ubuntu 22.04 inherently supports snaps, ensuring that you can proceed by verifying the up-to-dateness of your snapd core package."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo snap install core; sudo snap refresh core\n")),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"If you get the error: ",(0,i.kt)("strong",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"strong"},"snap: command not found"))," run the commands below:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre"},"sudo apt-get update\n")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre"},"sudo apt-get install snapd\n")),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre"},"sudo snap install core; sudo snap refresh core\n"))),(0,i.kt)("admonition",{title:"skip if you have never had the old certbot files installed",type:"note"},(0,i.kt)("p",{parentName:"admonition"},"In the event that your server previously hosted an older version of Certbot, it's advisable to remove it before proceeding:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre"},"sudo apt remove certbot\n"))),(0,i.kt)("p",null,"Subsequently, you can proceed with the installation of the Certbot package:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo snap install --classic certbot\n")),(0,i.kt)("p",null,'To conclude, you should create a symbolic link from the Certbot command in the snap installation directory to your path. This will enable you to execute Certbot by simply entering the command "certbot." While not essential for all packages, this step is often unnecessary with snaps due to their default non-intrusive nature, preventing unintended conflicts with other system packages:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo ln -s /snap/bin/certbot /usr/bin/certbot\n")),(0,i.kt)("p",null,"With Certbot now successfully installed, we can initiate it to obtain our desired certificate."),(0,i.kt)("h3",{id:"obtaining-an-ssl-certificate"},"Obtaining an SSL Certificate"),(0,i.kt)("p",null,"run the below commands and follow the prompts"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"enter an email address and agree to the terms of service")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo certbot --nginx -d tcadmin.yourdomain.com\n")),(0,i.kt)("p",null,"output:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"Output\nIMPORTANT NOTES:\nSuccessfully received certificate.\nCertificate is saved at: /etc/letsencrypt/live/tcadmin.yourdomain.com/fullchain.pem\nKey is saved at: /etc/letsencrypt/live/tcadmin.yourdomain.com/privkey.pem\nThis certificate expires on 2022-06-01.\nThese files will be updated when the certificate renews.\nCertbot has set up a scheduled task to automatically renew this certificate in the background.\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nIf you like Certbot, please consider supporting our work by:\n* Donating to ISRG / Let's Encrypt: https://letsencrypt.org/donate\n* Donating to EFF: https://eff.org/donate-le\n")),(0,i.kt)("h3",{id:"verifying-certbot-auto-renewal"},"Verifying Certbot Auto-Renewal"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Let\u2019s Encrypt\u2019s certificates are only valid for ninety days. This is to encourage users to automate their certificate renewal process.")),(0,i.kt)("p",null,"You can query the status of the timer with systemctl:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo systemctl status snap.certbot.renew.service\n")),(0,i.kt)("p",null,"Output:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"\u25cb snap.certbot.renew.service - Service for snap application certbot.renew\n     Loaded: loaded (/etc/systemd/system/snap.certbot.renew.service; static)\n     Active: inactive (dead)\nTriggeredBy: \u25cf snap.certbot.renew.timer\n")),(0,i.kt)("h3",{id:"create-a-self-signed-certificate-optional"},"Create a self signed certificate (optional)"),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"If you have ran the setup for Lets Encrypt you do not need this step and it can be skipped")),(0,i.kt)("p",null,"The default certificate and private key used by TCAdmin are not compatible with nginx. You must create new ones. Execute the following commands. When it asks for a passphrase enter a word that you can remember. If you already have a certificate place the files in the Monitor folder, make tcadmin the owner and update the paths in the ssl_certificate and ssl_certificate_key parameters."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"cd /home/tcadmin/Monitor\nopenssl genrsa -des3 -out nginx.key 2048\n")),(0,i.kt)("p",null,"Execute this command. Enter the passphrase that you used in the first step. You can leave all other values blank."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},"openssl req -new -key nginx.key -out nginx.csr\n")),(0,i.kt)("p",null,"Execute this command. Enter the passphrase that you used in the first step."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"mv nginx.key nginx.key.org\nopenssl rsa -in nginx.key.org -out nginx.key\n")),(0,i.kt)("p",null,"Execute this command to create the certificate file."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"openssl x509 -req -days 7300 -in nginx.csr -signkey nginx.key -out nginx.crt\n")),(0,i.kt)("p",null,"Add the following lines to ",(0,i.kt)("inlineCode",{parentName:"p"},"/etc/nginx/sites-available/default")," under listen 8880;."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"listen   8881 ssl;\nssl_certificate /home/tcadmin/Monitor/nginx.crt;\nssl_certificate_key /home/tcadmin/Monitor/nginx.key;\n")),(0,i.kt)("p",null,"After updating the file restart the nginx server:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo systemctl restart nginx\n")),(0,i.kt)("h2",{id:"change-the-default-ports-optional"},"Change the default ports (optional)"),(0,i.kt)("p",null,"If you change the default ports in /etc/nginx/sites-available/default make sure you update the values of ",(0,i.kt)("inlineCode",{parentName:"p"},"WEB_PORT")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"SECURE_WEB_PORT")," in ",(0,i.kt)("inlineCode",{parentName:"p"},"/home/tcadmin/Monitor/tcadmin-config")," and restart the monitor service:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/home/tcadmin/Monitor/monitor-service restart\n")),(0,i.kt)("h2",{id:"enable-logging-optional"},"Enable logging (optional)"),(0,i.kt)("p",null,"Logging is commented out in the above configuration. You can enable it by changing ",(0,i.kt)("inlineCode",{parentName:"p"},"#access_log")," to access_log and reloading the nginx service. That will create a single log file that can get huge after a few days. You can configure log rotation with these instructions: ",(0,i.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/tutorials/how-to-configure-logging-and-log-rotation-in-nginx-on-an-ubuntu-vps"},"https://www.digitalocean.com/community/tutorials/how-to-configure-logging-and-log-rotation-in-nginx-on-an-ubuntu-vps")),(0,i.kt)("h2",{id:"common-errors"},"Common Errors"),(0,i.kt)("h3",{id:"object-reference-error-when-logging-in"},"Object reference error when logging in"),(0,i.kt)("p",null,"This should only happen the first time you log in after changing the web server."),(0,i.kt)("h3",{id:"port-already-in-use"},"Port already in use"),(0,i.kt)("p",null,"If Nginx says the port is already in use make sure you configured TCAdmin to start the fastcgi server instead of the built in web server and restarted the monitor. Also check if there is a process using port 8880 and kill it:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"netstat -tlnp|grep 8880\n")),(0,i.kt)("h3",{id:"website-doesnt-load"},"Website doesn't load"),(0,i.kt)("p",null,"Try starting nginx:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"sudo systemctl restart nginx\n")),(0,i.kt)("h3",{id:"website-errors-every-few-minutes"},"Website errors every few minutes"),(0,i.kt)("p",null,"Edit ",(0,i.kt)("inlineCode",{parentName:"p"},"/home/tcadmin/Monitor/TCAdminMonitor.exe.config"),". Change the value of ",(0,i.kt)("inlineCode",{parentName:"p"},"TCAdmin.CheckWebHealth")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"False")," and restart the monitor."))}g.isMDXComponent=!0}}]);